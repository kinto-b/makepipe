<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to makepipe • makepipe</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to makepipe">
<meta property="og:description" content="makepipe">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">makepipe</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/makepipe.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kinto-b/makepipe/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to makepipe</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kinto-b/makepipe/blob/HEAD/vignettes/makepipe.Rmd" class="external-link"><code>vignettes/makepipe.Rmd</code></a></small>
      <div class="hidden name"><code>makepipe.Rmd</code></div>

    </div>

    
    
<p>Broadly, <code>makepipe</code> does two things:</p>
<ul>
<li><p>It automates code execution using a logic similar to GNU Make. In
particular, makepipe ensures that a given piece of code is executed if
and only if the <code>targets</code> associated that piece of code are
out-of-date with respect to its <code>dependencies</code>. More on this
below.</p></li>
<li><p>It makes code self-documenting in a double sense. Firstly, it
forces data scientists to make the relationships between the different
parts of their code base explicit <strong>within</strong> the code base
itself. Secondly, it exhibits those relationships as a directed
acyclical graph (i.e. a flowchart) which can be separated from the code
base and shared.</p></li>
</ul>
<p>It does these things without requiring major upfront investments in
the way of code functionalisation or the like. Indeed, one will not
ordinarily need to modify one’s existing code at all in order to
implement a makepipe pipeline.</p>
<div class="section level2">
<h2 id="converting-an-existing-workflow">Converting an existing workflow<a class="anchor" aria-label="anchor" href="#converting-an-existing-workflow"></a>
</h2>
<p>Assuming your workflow consists of a series of R scripts –
<code>one.R</code>, <code>two.R</code>, etc. – you can construct a
makepipe <code>Pipeline</code> simply by sourcing them using
<code><a href="../reference/make_with_source.html">make_with_source()</a></code>.</p>
<p>You’ll just need to supply, along with the path to the
<code>source</code> script, a set of <code>targets</code> (i.e. paths to
files that the script is supposed to make) and optionally a set of
<code>dependencies</code> (i.e. paths to files that the script needs so
as to make the <code>targets</code>).</p>
<p>For example, you’ll create a <code>pipeline.R</code> script
containing the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kinto-b.github.io/makepipe/" class="external-link">makepipe</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_with_source.html">make_with_source</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"one.R"</span>, </span>
<span>  targets <span class="op">=</span> <span class="st">"data/1 data.Rds"</span>, </span>
<span>  dependencies <span class="op">=</span> <span class="st">"data/raw.Rds"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_with_source.html">make_with_source</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"two.R"</span>, </span>
<span>  targets <span class="op">=</span> <span class="st">"data/2 data.Rds"</span>, </span>
<span>  dependencies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data/1 data.Rds"</span>, <span class="st">"lookup/concordance.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># etc.</span></span></code></pre></div>
<p>Then, when this code is run through, each <code>source</code> file
will be executed if and only if its <code>targets</code> are out-of-date
with respect to its <code>dependencies</code> (and <code>source</code>
file itself). This means that only those scripts which <em>need</em> to
be run will be. So, without requiring you to think about it, you’ll be
able to skip unnecessary computations.</p>
<p>Meanwhile, behind the scenes, each call to
<code><a href="../reference/make_with_source.html">make_with_source()</a></code> will add a <code>Segment</code> onto the
<code>Pipeline</code>. These <code>Segment</code> objects keep track of
the relationships between <code>targets</code>,
<code>dependencies</code> and <code>source</code> files and they also
log metadata relating to the execution of the <code>source</code> file
such as whether it was executed on the last run and how long it took to
execute.</p>
<p>You can inspect this metadata by getting ahold of the
<code>Pipeline</code>. For example, you might see something like
this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipeline-accessors.html">get_pipeline</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pipe</span><span class="op">$</span><span class="va">segments</span></span>
<span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; # makepipe segment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## one.R</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Source: 'one.R'</span></span>
<span><span class="co">#&gt; * Targets: 'data/1 data.Rds'</span></span>
<span><span class="co">#&gt; * File dependencies: 'data/raw.Rds'</span></span>
<span><span class="co">#&gt; * Executed: TRUE</span></span>
<span><span class="co">#&gt; * Execution time: 22.5 secs</span></span>
<span><span class="co">#&gt; * Result: 0 object(s)</span></span>
<span><span class="co">#&gt; * Environment: 0x00000253c8573268</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; # makepipe segment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## two.R</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Source: 'two.R'</span></span>
<span><span class="co">#&gt; * Targets: 'data/2 data.Rds'</span></span>
<span><span class="co">#&gt; * File dependencies: 'data/1 data.Rds', 'lookup/concordance.csv'</span></span>
<span><span class="co">#&gt; * Executed: TRUE</span></span>
<span><span class="co">#&gt; * Execution time: 38.2 secs</span></span>
<span><span class="co">#&gt; * Result: 0 object(s)</span></span>
<span><span class="co">#&gt; * Environment: 0x00000253c8738660</span></span></code></pre></div>
<p>Additionally, you can visualise the relationships between the various
files by viewing the <code>Pipeline</code> itself:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pipeline-vis.html">show_pipeline</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will display a flow chart exhibiting the relationships between
the <code>targets</code>, <code>dependencies</code>, and code.</p>
<div class="section level3">
<h3 id="make_">
<code>make_*()</code><a class="anchor" aria-label="anchor" href="#make_"></a>
</h3>
<p>We used <code><a href="../reference/make_with_source.html">make_with_source()</a></code> above since, in most cases,
that will be the simplest way to convert an existing workflow. In some
cases, however, your pipeline may include short pieces of code that
don’t need to reside in their own script. In such cases, you can use
<code><a href="../reference/make_with_recipe.html">make_with_recipe()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/make_with_recipe.html">make_with_recipe</a></span><span class="op">(</span></span>
<span>  recipe <span class="op">=</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span></span>
<span>        <span class="st">"report.Rmd"</span>,</span>
<span>        output_file <span class="op">=</span> <span class="st">"output/report.html"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    targets <span class="op">=</span> <span class="st">"output/report.html"</span>,</span>
<span>    dependencies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"report.Rmd"</span>, <span class="st">"data/2 data.Rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As with <code><a href="../reference/make_with_source.html">make_with_source()</a></code>, when a
<code><a href="../reference/make_with_recipe.html">make_with_recipe()</a></code> block is run the code (this time the
<code>recipe</code>) will only be executed if the relevant
<code>targets</code> are out-of-date with respect to their
<code>dependencies</code></p>
</div>
<div class="section level3">
<h3 id="roxygen">roxygen<a class="anchor" aria-label="anchor" href="#roxygen"></a>
</h3>
<p>Instead of maintaining a separate pipeline script containing calls to
<code><a href="../reference/make_with_source.html">make_with_source()</a></code>, you can add roxygen-like headers to the
.R files in your pipeline containing the <code>@makepipe</code> tag
along with <code>@targets</code>, <code>@dependencies</code>, and so on.
For example, at the top of script <code>one.R</code> you might have</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#'@title One</span></span>
<span><span class="co">#'@description This is the first script in our pipeline</span></span>
<span><span class="co">#'@dependencies "data/raw.Rds"</span></span>
<span><span class="co">#'@targets "data/1 data.Rds"</span></span>
<span><span class="co">#'@makepipe</span></span>
<span><span class="cn">NULL</span></span></code></pre></div>
<p>You can then call <code><a href="../reference/make_with_dir.html">make_with_dir()</a></code>, which will construct
a pipeline using all the scripts it finds in the provided directory
containing the <code>@makepipe</code> tag.</p>
<p>If you want to use a hybrid approach – keeping the documentation of
dependencies and targets close to the source code – while maintaining
the flexibility of a separate pipeline script you can use
<code><a href="../reference/make_with_dir.html">make_with_roxy()</a></code>. Thus you might have</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/make_with_dir.html">make_with_roxy</a></span><span class="op">(</span><span class="st">"one.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># do other stuff</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_with_dir.html">make_with_roxy</a></span><span class="op">(</span><span class="st">"two.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># etc.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="clean-and-build">Clean and build<a class="anchor" aria-label="anchor" href="#clean-and-build"></a>
</h2>
<p>Once you’ve constructed a <code>Pipeline</code> by calling
<code>make_*()</code>, you can re-run the entire pipeline using the
<code>build()</code> method. As when using <code>make_*()</code>
directly, only code that needs to be run will be when
<code>build()</code> is called.</p>
<p>For example, if you’ve just executed the Pipeline and nothing has
changed, then nothing will be re-executed and you’ll be told has
much:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipeline-accessors.html">get_pipeline</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pipe</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co">#&gt; √ Targets are up to date</span></span>
<span><span class="co">#&gt; √ Targets are up to date</span></span></code></pre></div>
<p>If you want to start from scratch and ‘rebuild’ all targets, you can
use the <code>build()</code> method together with the
<code>clean()</code> method.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipe</span><span class="op">$</span><span class="fu">clean</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pipe</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; i Targets are out of date. Updating...</span></span>
<span><span class="co">#&gt; √ Finished updating                   </span></span>
<span><span class="co">#&gt; i Targets are out of date. Updating...</span></span>
<span><span class="co">#&gt; √ Finished updating   </span></span></code></pre></div>
<p>The <code>clean()</code> and <code>build()</code> methods are
especially useful when used with a <code>Pipeline</code> that has
previously been saved out. In particular, if you’ve already created your
<code>Pipeline</code> by stringing <code>make_*()</code> calls together
and you’ve saved your <code>Pipeline</code> object out as
<code>pipeline.Rds</code> you can re-run the whole Pipeline to ensure
everything is up-to-date simply by calling:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"pipeline.Rds"</span><span class="op">)</span></span>
<span><span class="va">pipe</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="return-values-and-registration">Return values and registration<a class="anchor" aria-label="anchor" href="#return-values-and-registration"></a>
</h2>
<p>Each <code>Segment</code> on the <code>Pipeline</code> is associated
with a <code>result</code>. This is akin to a return value. Indeed, in
the case of <code><a href="../reference/make_with_recipe.html">make_with_recipe()</a></code> it <em>is</em> the return
value of the <code>recipe</code>. For example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_with_recipe.html">make_with_recipe</a></span><span class="op">(</span></span>
<span>    recipe <span class="op">=</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="st">"data/mtcars.Rds"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    targets <span class="op">=</span> <span class="st">"data/mtcars.Rds"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; i Targets are out of date. Updating...</span></span>
<span><span class="co">#&gt; √ Finished updating                   </span></span>
<span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="co">#&gt; [1] 32</span></span></code></pre></div>
<p>Note, however, that the <code>result</code> is captured when the
<code>recipe</code> is executed. If your <code>recipe</code> is never
executed, then there will be no <code>result</code> available. Thus, for
instance:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_with_recipe.html">make_with_recipe</a></span><span class="op">(</span></span>
<span>    recipe <span class="op">=</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="st">"data/mtcars.Rds"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    targets <span class="op">=</span> <span class="st">"data/mtcars.Rds"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; √ Targets are up to date</span></span>
<span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Things are a little more complicated in the case of
<code><a href="../reference/make_with_source.html">make_with_source()</a></code>, as you can imagine. Given that source
scripts do not really have return values, the <code>result</code> cannot
be what <code>source</code> returns when run. So what is it?</p>
<p>The <code>result</code> associated with a source <code>Segment</code>
is an environment containing objects ‘registered’ in the
<code>source</code> script. Objects are registered using
<code><a href="../reference/make_register.html">make_register()</a></code>, which has a similar API to
<code><a href="https://rdrr.io/r/base/assign.html" class="external-link">base::assign()</a></code>. Thus, imagine that <code>three.R</code>
contains the following code:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ...</span></span>
<span><span class="fu">makepipe</span><span class="fu">::</span><span class="fu"><a href="../reference/make_register.html">make_register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, <span class="st">"num_rows"</span><span class="op">)</span></span>
<span><span class="co"># ...</span></span></code></pre></div>
<p>Then we will have:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_with_source.html">make_with_source</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="st">"three.R"</span>,</span>
<span>    targets <span class="op">=</span> <span class="st">"data/3 data.Rds"</span>,</span>
<span>    dependencies <span class="op">=</span> <span class="st">"data/2 data.Rds"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; i Targets are out of date. Updating...</span></span>
<span><span class="co">#&gt; √ Finished updating </span></span>
<span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000029f6840f610&gt;</span></span>
<span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">num_rows</span></span>
<span><span class="co">#&gt; [1] 32</span></span></code></pre></div>
<p>As with <code><a href="../reference/make_with_recipe.html">make_with_recipe()</a></code>, a <code>result</code> will
only be captured if the <code>source</code> script is executed.</p>
</div>
<div class="section level2">
<h2 id="execution-details">Execution details<a class="anchor" aria-label="anchor" href="#execution-details"></a>
</h2>
<p>So when does a <code>source</code> file or a <code>recipe</code> get
executed? The answer is: when and only when the relevant
<code>targets</code> are out-of-date with respect to the
<code>dependencies</code>. But what does that mean? Specifically, the
<code>targets</code> are out-of-date if and only if:</p>
<ul>
<li><p>One or more of the <code>targets</code> do not exist, OR</p></li>
<li><p>One or more of the <code>dependencies</code> is <em>newer</em>
(i.e. has a more recent file modification time) than one or more of the
<code>targets</code>. In other words, the <code>dependencies</code> have
been updated since the <code>targets</code> were last made.</p></li>
</ul>
<p>By default the execution will take place in a fresh environment which
is a child of the calling environment. So if you’re calling
<code>make_*()</code> in a top-level script then the execution will take
place in a fresh environment whose parent is the global environment.</p>
<p>There are a number of less commonly used arguments to
<code>make_*()</code> which alter this behaviour. In particular:</p>
<ul>
<li><p><code>packages</code> can be used to supply the names of packages
which serve as dependencies for the <code>targets</code>. If any of
these packages have been updated since the <code>targets</code> were
last made, the <code>targets</code> will be remade. This is particularly
useful when you’re relying on a package for lookups which are liable to
change.</p></li>
<li><p><code>envir</code> can be used to supply an environment in which
the execution of the <code>source</code> or <code>recipe</code> will
take place. Supplying <code>envir = base::globalenv()</code>, for
example, will mean that all execution takes place in the global
environment. If you do this, then all the objects bound in the
<code>recipe</code>/<code>source</code> will be available in the global
environment.</p></li>
<li><p><code>force</code> can be used to ensure that the
<code>recipe</code>/<code>source</code> is executed no matter what. This
is useful, e.g., when you are pulling in some data from an external
database.</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kinto Behr.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
